<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SubTracker - Basketball Substitution Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Roboto+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --court-green: #1a472a;
            --court-dark: #0d2818;
            --bench-gray: #2a2a2a;
            --active-gold: #ffc107;
            --accent-orange: #ff6b35;
            --text-white: #ffffff;
            --text-muted: #9ca3af;
            --danger-red: #ef4444;
            --success-green: #22c55e;
            --card-bg: #1f1f1f;
            --body-bg: #121212;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Oswald', sans-serif;
            background: var(--body-bg);
            color: var(--text-white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 1.5rem 0;
            border-bottom: 3px solid var(--active-gold);
            margin-bottom: 1.5rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: 4px;
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--active-gold), var(--accent-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-muted);
            font-family: 'Roboto Mono', monospace;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        /* Game Clock Section */
        .clock-section {
            background: linear-gradient(180deg, var(--court-dark) 0%, var(--court-green) 100%);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(255, 193, 7, 0.3);
            position: relative;
            overflow: hidden;
        }

        .clock-section::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 2px dashed rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            pointer-events: none;
        }

        .clock-display {
            font-family: 'Roboto Mono', monospace;
            font-size: 5rem;
            font-weight: 600;
            text-align: center;
            letter-spacing: 4px;
            text-shadow: 0 0 30px rgba(255, 193, 7, 0.5);
            position: relative;
            z-index: 1;
        }

        .clock-label {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 0.5rem;
        }

        .clock-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .btn {
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--success-green);
            color: var(--body-bg);
        }

        .btn-primary:hover {
            background: #16a34a;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger-red);
            color: var(--text-white);
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--bench-gray);
            color: var(--text-white);
            border: 1px solid var(--text-muted);
        }

        .btn-secondary:hover {
            background: #3a3a3a;
            transform: translateY(-2px);
        }

        .btn-gold {
            background: var(--active-gold);
            color: var(--body-bg);
        }

        .btn-gold:hover {
            background: #e6ac00;
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Settings Row */
        .settings-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .setting-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .setting-group label {
            color: var(--text-muted);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .setting-group input {
            font-family: 'Roboto Mono', monospace;
            font-size: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid var(--text-muted);
            background: var(--card-bg);
            color: var(--text-white);
            width: 80px;
            text-align: center;
        }

        .setting-group input:focus {
            outline: none;
            border-color: var(--active-gold);
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Section Cards */
        .section-card {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
        }

        .section-header {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header.court {
            background: linear-gradient(90deg, var(--court-green), var(--court-dark));
        }

        .section-header.bench {
            background: var(--bench-gray);
        }

        .section-header.roster {
            background: linear-gradient(90deg, #1e3a5f, #0f1f33);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-title .icon {
            font-size: 1.5rem;
        }

        .player-count {
            font-family: 'Roboto Mono', monospace;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--active-gold);
        }

        .section-body {
            padding: 1rem;
            min-height: 200px;
        }

        /* Player Cards */
        .player-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 1rem;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .player-card:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .player-card.on-court {
            border-color: var(--success-green);
            background: rgba(34, 197, 94, 0.1);
        }

        .player-card.on-bench {
            border-color: var(--text-muted);
        }

        .player-number {
            font-family: 'Roboto Mono', monospace;
            font-size: 1.75rem;
            font-weight: 700;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--active-gold);
            color: var(--body-bg);
            border-radius: 8px;
        }

        .player-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .player-name {
            font-size: 1.125rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .player-times {
            display: flex;
            gap: 1.5rem;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .time-stat {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .time-stat .label {
            font-size: 0.625rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .time-stat .value {
            font-size: 0.875rem;
            color: var(--text-white);
        }

        .time-stat .value.warning {
            color: var(--accent-orange);
        }

        .time-stat .value.danger {
            color: var(--danger-red);
        }

        .player-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sub {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 1.25rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-sub.sub-in {
            background: var(--success-green);
            color: var(--body-bg);
        }

        .btn-sub.sub-in:hover {
            background: #16a34a;
            transform: scale(1.1);
        }

        .btn-sub.sub-out {
            background: var(--danger-red);
            color: var(--text-white);
        }

        .btn-sub.sub-out:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .btn-sub:disabled {
            background: var(--bench-gray);
            color: var(--text-muted);
            cursor: not-allowed;
            transform: none;
        }

        /* Roster Management */
        .roster-section {
            margin-top: 1.5rem;
        }

        .add-player-form {
            display: flex;
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .add-player-form input {
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--text-muted);
            background: var(--card-bg);
            color: var(--text-white);
            flex: 1;
            min-width: 120px;
        }

        .add-player-form input:focus {
            outline: none;
            border-color: var(--active-gold);
        }

        .add-player-form input::placeholder {
            color: var(--text-muted);
        }

        .roster-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 1rem;
        }

        .roster-chip {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .roster-chip.active {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid var(--success-green);
        }

        .roster-chip.inactive {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid transparent;
            opacity: 0.6;
        }

        .roster-chip .chip-number {
            font-family: 'Roboto Mono', monospace;
            font-weight: 600;
            color: var(--active-gold);
        }

        .roster-chip .chip-name {
            font-weight: 500;
        }

        .roster-chip .chip-toggle {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .roster-chip .chip-toggle.toggle-active {
            background: var(--success-green);
            color: var(--body-bg);
        }

        .roster-chip .chip-toggle.toggle-inactive {
            background: var(--text-muted);
            color: var(--body-bg);
        }

        .roster-chip .chip-delete {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .roster-chip .chip-delete:hover {
            background: var(--danger-red);
            color: var(--text-white);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
        }

        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 0.875rem;
        }

        /* Stats Summary */
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-card .stat-value {
            font-family: 'Roboto Mono', monospace;
            font-size: 2rem;
            font-weight: 600;
            color: var(--active-gold);
        }

        .stat-card .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.5rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: flex-end;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .clock-display {
                font-size: 3rem;
            }

            .header h1 {
                font-size: 1.75rem;
            }

            .player-card {
                grid-template-columns: 40px 1fr 44px;
                gap: 0.5rem;
                padding: 0.75rem;
            }

            .player-number {
                width: 40px;
                height: 40px;
                font-size: 1.25rem;
            }

            .player-name {
                font-size: 1rem;
            }

            .player-times {
                gap: 0.75rem;
                flex-wrap: wrap;
            }

            .time-stat .value {
                font-size: 0.75rem;
            }

            .time-stat .label {
                font-size: 0.5rem;
            }

            .btn-sub {
                width: 40px;
                height: 40px;
            }

            .settings-row {
                flex-direction: column;
                gap: 1rem;
            }
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .clock-running .clock-display {
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .player-card {
            animation: slideIn 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>SubTracker</h1>
            <p>Basketball Substitution Manager</p>
        </header>

        <!-- Game Clock Section -->
        <section class="clock-section" id="clockSection">
            <div class="clock-display" id="clockDisplay">00:00</div>
            <div class="clock-label">Game Time Elapsed</div>
            
            <div class="clock-controls">
                <button class="btn btn-primary" id="startBtn" onclick="toggleClock()">
                    <span>‚ñ∂</span> Start
                </button>
                <button class="btn btn-danger" id="resetBtn" onclick="resetGame()">
                    <span>‚Ü∫</span> Reset Game
                </button>
            </div>

            <div class="settings-row">
                <div class="setting-group">
                    <label>Game Length (min)</label>
                    <input type="number" id="gameLength" value="32" min="1" max="60" onchange="updateGameLength()">
                </div>
                <div class="setting-group">
                    <label>Players on Court</label>
                    <input type="number" id="playersOnCourt" value="5" min="1" max="10" onchange="updatePlayersOnCourt()">
                </div>
            </div>
        </section>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- On Court Section -->
            <section class="section-card">
                <div class="section-header court">
                    <span class="section-title">
                        <span class="icon">üèÄ</span>
                        On Court
                    </span>
                    <span class="player-count" id="courtCount">0/5</span>
                </div>
                <div class="section-body">
                    <div class="player-list" id="courtList">
                        <div class="empty-state">
                            <div class="icon">üèÄ</div>
                            <p>No players on court<br>Add players from the bench</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- On Bench Section -->
            <section class="section-card">
                <div class="section-header bench">
                    <span class="section-title">
                        <span class="icon">ü™ë</span>
                        On Bench
                    </span>
                    <span class="player-count" id="benchCount">0</span>
                </div>
                <div class="section-body">
                    <div class="player-list" id="benchList">
                        <div class="empty-state">
                            <div class="icon">ü™ë</div>
                            <p>No players on bench<br>Add players to your roster below</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Roster Management -->
        <section class="section-card roster-section">
            <div class="section-header roster">
                <span class="section-title">
                    <span class="icon">üìã</span>
                    Team Roster
                </span>
                <span class="player-count" id="rosterCount">0 players</span>
            </div>
            <div class="section-body">
                <div class="add-player-form">
                    <input type="text" id="playerName" placeholder="Player Name" maxlength="20">
                    <input type="number" id="playerNumber" placeholder="#" min="0" max="99">
                    <button class="btn btn-gold" onclick="addPlayer()">+ Add Player</button>
                </div>
                <p style="color: var(--text-muted); font-size: 0.75rem; padding: 0 1rem; margin-bottom: 0.5rem;">
                    Click ‚úì to include player in today's game. Click √ó to remove from roster.
                </p>
                <div class="roster-list" id="rosterList">
                    <!-- Roster chips will be added here -->
                </div>
            </div>
        </section>

        <!-- Stats Summary -->
        <div class="stats-summary">
            <div class="stat-card">
                <div class="stat-value" id="totalGameTime">00:00</div>
                <div class="stat-label">Game Time</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="timeRemaining">32:00</div>
                <div class="stat-label">Time Remaining</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalSubs">0</div>
                <div class="stat-label">Substitutions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgPlayTime">00:00</div>
                <div class="stat-label">Avg Play Time</div>
            </div>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div class="modal-overlay" id="resetModal">
        <div class="modal">
            <h2>Reset Game?</h2>
            <p>This will reset all game times and statistics. Player roster will be preserved.</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeResetModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmReset()">Reset Game</button>
            </div>
        </div>
    </div>

    <script>
        // State
        let roster = [];
        let gameLength = 32; // minutes
        let maxOnCourt = 5;
        let gameTime = 0; // seconds elapsed
        let isRunning = false;
        let clockInterval = null;
        let totalSubs = 0;

        // Load from localStorage
        function loadState() {
            const saved = localStorage.getItem('subtracker_roster');
            if (saved) {
                roster = JSON.parse(saved);
            }
            const savedLength = localStorage.getItem('subtracker_gameLength');
            if (savedLength) {
                gameLength = parseInt(savedLength);
                document.getElementById('gameLength').value = gameLength;
            }
            const savedMax = localStorage.getItem('subtracker_maxOnCourt');
            if (savedMax) {
                maxOnCourt = parseInt(savedMax);
                document.getElementById('playersOnCourt').value = maxOnCourt;
            }
        }

        // Save to localStorage
        function saveState() {
            localStorage.setItem('subtracker_roster', JSON.stringify(roster));
            localStorage.setItem('subtracker_gameLength', gameLength.toString());
            localStorage.setItem('subtracker_maxOnCourt', maxOnCourt.toString());
        }

        // Format time (seconds to MM:SS)
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Add player to roster
        function addPlayer() {
            const nameInput = document.getElementById('playerName');
            const numberInput = document.getElementById('playerNumber');
            
            const name = nameInput.value.trim();
            const number = numberInput.value.trim();

            if (!name) {
                alert('Please enter a player name');
                return;
            }

            // Check for duplicate number
            if (number && roster.some(p => p.number === number)) {
                alert('A player with this number already exists');
                return;
            }

            const player = {
                id: Date.now(),
                name: name,
                number: number || '?',
                activeForGame: true,
                onCourt: false,
                totalPlayTime: 0,
                currentStintTime: 0,
                totalBenchTime: 0,
                currentBenchTime: 0
            };

            roster.push(player);
            saveState();
            render();

            nameInput.value = '';
            numberInput.value = '';
            nameInput.focus();
        }

        // Remove player from roster
        function removePlayer(id) {
            const player = roster.find(p => p.id === id);
            if (player && player.onCourt) {
                alert('Cannot remove a player who is currently on court');
                return;
            }
            roster = roster.filter(p => p.id !== id);
            saveState();
            render();
        }

        // Toggle player active for today's game
        function togglePlayerActive(id) {
            const player = roster.find(p => p.id === id);
            if (player) {
                if (player.onCourt) {
                    alert('Cannot deactivate a player who is currently on court. Sub them out first.');
                    return;
                }
                player.activeForGame = !player.activeForGame;
                saveState();
                render();
            }
        }

        // Sub player in
        function subIn(id) {
            const onCourtCount = roster.filter(p => p.onCourt).length;
            if (onCourtCount >= maxOnCourt) {
                alert(`Maximum ${maxOnCourt} players on court. Sub someone out first.`);
                return;
            }

            const player = roster.find(p => p.id === id);
            if (player) {
                player.onCourt = true;
                player.currentStintTime = 0;
                player.currentBenchTime = 0;
                totalSubs++;
                render();
            }
        }

        // Sub player out
        function subOut(id) {
            const player = roster.find(p => p.id === id);
            if (player) {
                player.onCourt = false;
                player.currentBenchTime = 0;
                render();
            }
        }

        // Toggle clock
        function toggleClock() {
            if (isRunning) {
                pauseClock();
            } else {
                startClock();
            }
        }

        // Start clock
        function startClock() {
            isRunning = true;
            document.getElementById('clockSection').classList.add('clock-running');
            document.getElementById('startBtn').innerHTML = '<span>‚è∏</span> Pause';
            document.getElementById('startBtn').classList.remove('btn-primary');
            document.getElementById('startBtn').classList.add('btn-secondary');
            
            clockInterval = setInterval(() => {
                gameTime++;
                updatePlayerTimes();
                updateTimeDisplays();
            }, 1000);
        }

        // Pause clock
        function pauseClock() {
            isRunning = false;
            document.getElementById('clockSection').classList.remove('clock-running');
            document.getElementById('startBtn').innerHTML = '<span>‚ñ∂</span> Start';
            document.getElementById('startBtn').classList.remove('btn-secondary');
            document.getElementById('startBtn').classList.add('btn-primary');
            
            if (clockInterval) {
                clearInterval(clockInterval);
                clockInterval = null;
            }
        }

        // Update player times
        function updatePlayerTimes() {
            roster.forEach(player => {
                if (player.activeForGame) {
                    if (player.onCourt) {
                        player.totalPlayTime++;
                        player.currentStintTime++;
                    } else {
                        player.totalBenchTime++;
                        player.currentBenchTime++;
                    }
                }
            });
        }

        // Lightweight time-only update (called every second)
        function updateTimeDisplays() {
            // Update main clock
            document.getElementById('clockDisplay').textContent = formatTime(gameTime);
            
            // Update stats
            document.getElementById('totalGameTime').textContent = formatTime(gameTime);
            const remaining = Math.max(0, (gameLength * 60) - gameTime);
            document.getElementById('timeRemaining').textContent = formatTime(remaining);
            
            // Calculate and update average play time
            const activePlayers = roster.filter(p => p.activeForGame);
            if (activePlayers.length > 0) {
                const totalPlayTime = activePlayers.reduce((sum, p) => sum + p.totalPlayTime, 0);
                const avgTime = totalPlayTime / activePlayers.length;
                document.getElementById('avgPlayTime').textContent = formatTime(avgTime);
            }
            
            // Update individual player time displays
            roster.forEach(player => {
                if (player.activeForGame) {
                    const stintEl = document.getElementById(`stint-${player.id}`);
                    const benchTimeEl = document.getElementById(`benchTime-${player.id}`);
                    const totalPlayEl = document.getElementById(`totalPlay-${player.id}`);
                    const totalBenchEl = document.getElementById(`totalBench-${player.id}`);
                    
                    if (player.onCourt) {
                        if (stintEl) {
                            stintEl.textContent = formatTime(player.currentStintTime);
                            stintEl.className = `value ${getTimeClass(player.currentStintTime, 240, 360)}`;
                        }
                    } else {
                        if (benchTimeEl) {
                            benchTimeEl.textContent = formatTime(player.currentBenchTime);
                            benchTimeEl.className = `value ${getTimeClass(player.currentBenchTime, 180, 300)}`;
                        }
                    }
                    
                    if (totalPlayEl) {
                        totalPlayEl.textContent = formatTime(player.totalPlayTime);
                    }
                    if (totalBenchEl) {
                        totalBenchEl.textContent = formatTime(player.totalBenchTime);
                    }
                }
            });
        }

        // Reset game
        function resetGame() {
            document.getElementById('resetModal').classList.add('active');
        }

        function closeResetModal() {
            document.getElementById('resetModal').classList.remove('active');
        }

        function confirmReset() {
            pauseClock();
            gameTime = 0;
            totalSubs = 0;
            
            roster.forEach(player => {
                player.onCourt = false;
                player.totalPlayTime = 0;
                player.currentStintTime = 0;
                player.totalBenchTime = 0;
                player.currentBenchTime = 0;
            });
            
            saveState();
            closeResetModal();
            render();
        }

        // Update game length
        function updateGameLength() {
            gameLength = parseInt(document.getElementById('gameLength').value) || 32;
            saveState();
            render();
        }

        // Update max players on court
        function updatePlayersOnCourt() {
            maxOnCourt = parseInt(document.getElementById('playersOnCourt').value) || 5;
            saveState();
            render();
        }

        // Get time class for styling
        function getTimeClass(seconds, threshold1 = 180, threshold2 = 300) {
            if (seconds >= threshold2) return 'danger';
            if (seconds >= threshold1) return 'warning';
            return '';
        }

        // Render player card
        function renderPlayerCard(player, location) {
            const stintClass = getTimeClass(player.currentStintTime, 240, 360);
            const benchClass = getTimeClass(player.currentBenchTime, 180, 300);
            
            return `
                <div class="player-card ${location === 'court' ? 'on-court' : 'on-bench'}" data-player-id="${player.id}">
                    <div class="player-number">${player.number}</div>
                    <div class="player-info">
                        <div class="player-name">${player.name}</div>
                        <div class="player-times">
                            ${location === 'court' ? `
                                <div class="time-stat">
                                    <span class="label">Current Stint</span>
                                    <span class="value ${stintClass}" id="stint-${player.id}">${formatTime(player.currentStintTime)}</span>
                                </div>
                            ` : `
                                <div class="time-stat">
                                    <span class="label">On Bench</span>
                                    <span class="value ${benchClass}" id="benchTime-${player.id}">${formatTime(player.currentBenchTime)}</span>
                                </div>
                            `}
                            <div class="time-stat">
                                <span class="label">Total Play</span>
                                <span class="value" id="totalPlay-${player.id}">${formatTime(player.totalPlayTime)}</span>
                            </div>
                            <div class="time-stat">
                                <span class="label">Total Bench</span>
                                <span class="value" id="totalBench-${player.id}">${formatTime(player.totalBenchTime)}</span>
                            </div>
                        </div>
                    </div>
                    <div class="player-actions">
                        ${location === 'court' 
                            ? `<button class="btn-sub sub-out" onclick="subOut(${player.id})" title="Sub Out">‚Üì</button>`
                            : `<button class="btn-sub sub-in" onclick="subIn(${player.id})" title="Sub In" ${roster.filter(p => p.onCourt).length >= maxOnCourt ? 'disabled' : ''}>‚Üë</button>`
                        }
                    </div>
                </div>
            `;
        }

        // Render roster chip
        function renderRosterChip(player) {
            return `
                <div class="roster-chip ${player.activeForGame ? 'active' : 'inactive'}">
                    <span class="chip-number">#${player.number}</span>
                    <span class="chip-name">${player.name}</span>
                    <button class="chip-toggle ${player.activeForGame ? 'toggle-active' : 'toggle-inactive'}" 
                            onclick="togglePlayerActive(${player.id})" 
                            title="${player.activeForGame ? 'Active for game - click to deactivate' : 'Inactive - click to activate'}">
                        ${player.activeForGame ? '‚úì' : '‚óã'}
                    </button>
                    <button class="chip-delete" onclick="removePlayer(${player.id})" title="Remove from roster">√ó</button>
                </div>
            `;
        }

        // Main render function
        function render() {
            // Update clock display
            document.getElementById('clockDisplay').textContent = formatTime(gameTime);
            
            // Get active players
            const activePlayers = roster.filter(p => p.activeForGame);
            const onCourt = activePlayers.filter(p => p.onCourt);
            const onBench = activePlayers.filter(p => !p.onCourt);

            // Update counts
            document.getElementById('courtCount').textContent = `${onCourt.length}/${maxOnCourt}`;
            document.getElementById('benchCount').textContent = onBench.length;
            document.getElementById('rosterCount').textContent = `${roster.length} players (${activePlayers.length} active)`;

            // Render court list
            const courtList = document.getElementById('courtList');
            if (onCourt.length === 0) {
                courtList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üèÄ</div>
                        <p>No players on court<br>Add players from the bench</p>
                    </div>
                `;
            } else {
                courtList.innerHTML = onCourt.map(p => renderPlayerCard(p, 'court')).join('');
            }

            // Render bench list
            const benchList = document.getElementById('benchList');
            if (onBench.length === 0) {
                benchList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ü™ë</div>
                        <p>No players on bench<br>${activePlayers.length === 0 ? 'Add players to your roster below' : 'All active players are on court'}</p>
                    </div>
                `;
            } else {
                // Sort bench by bench time (longest first)
                const sortedBench = [...onBench].sort((a, b) => b.currentBenchTime - a.currentBenchTime);
                benchList.innerHTML = sortedBench.map(p => renderPlayerCard(p, 'bench')).join('');
            }

            // Render roster list
            const rosterList = document.getElementById('rosterList');
            if (roster.length === 0) {
                rosterList.innerHTML = '<p style="color: var(--text-muted); padding: 1rem;">No players in roster. Add players above.</p>';
            } else {
                // Sort by number
                const sortedRoster = [...roster].sort((a, b) => {
                    const numA = parseInt(a.number) || 999;
                    const numB = parseInt(b.number) || 999;
                    return numA - numB;
                });
                rosterList.innerHTML = sortedRoster.map(p => renderRosterChip(p)).join('');
            }

            // Update stats
            document.getElementById('totalGameTime').textContent = formatTime(gameTime);
            const remaining = Math.max(0, (gameLength * 60) - gameTime);
            document.getElementById('timeRemaining').textContent = formatTime(remaining);
            document.getElementById('totalSubs').textContent = totalSubs;
            
            // Calculate average play time
            if (activePlayers.length > 0) {
                const totalPlayTime = activePlayers.reduce((sum, p) => sum + p.totalPlayTime, 0);
                const avgTime = totalPlayTime / activePlayers.length;
                document.getElementById('avgPlayTime').textContent = formatTime(avgTime);
            } else {
                document.getElementById('avgPlayTime').textContent = '00:00';
            }
        }

        // Handle Enter key in input fields
        document.getElementById('playerName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('playerNumber').focus();
            }
        });

        document.getElementById('playerNumber').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addPlayer();
            }
        });

        // Initialize
        loadState();
        render();
    </script>
</body>
</html>
